version: '3.7'

services:
  frontend:
    build:
      context: ./apps/frontend
    ports:
      - "3000:3000"
    env_file:
      - ./apps/frontend/.env

  backend:
    build:
      context: ./apps/backend
    ports:
      - "3001:3001"
    env_file:
      - ./apps/backend/.env

  livekit:
    image: livekit/livekit-server:latest
    restart: unless-stopped
    ports:
      - "7880:7880"   # WebSocket + REST API
      - "7881:7881/udp"   # UDP (media)
      - "7882:7882"   # TCP (fallback media)
    env_file:
      - ./infrastructure/livekit/.env
    command: [
      "--config", "/infrastructure/livekit/livekit.yaml"
    ]
    volumes:
      - ./infrastructure/livekit:/infrastructure/livekit
